<script>
    document.addEventListener("DOMContentLoaded", function() {
        const fileInput = document.getElementById("soaFile");

        if (!fileInput) {
            console.error("No se encontró el elemento con id 'soaFile'.");
            return;
        }

        fileInput.addEventListener("change", handleFile);

        function handleFile(event) {
            const file = event.target.files[0];
            if (!file) {
                console.warn("No se seleccionó ningún archivo.");
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                const rows = content.split("\n");
                const delimiter = detectDelimiter(content);

                displayPreview(rows, delimiter);
            };
            reader.readAsText(file);
        }

        function detectDelimiter(content) {
            const delimiters = [',', '\t', ';'];
            const counts = delimiters.map(delimiter => content.split(delimiter).length);
            return delimiters[counts.indexOf(Math.max(...counts))];
        }

        function displayPreview(rows, delimiter) {
            const previewDiv = document.getElementById("preview");
            if (rows.length < 2) {
                previewDiv.innerHTML = "<p>El archivo no contiene suficientes datos.</p>";
                return;
            }

            let tableHtml = "<table><thead><tr>";
            const headers = rows[0].split(delimiter);

            headers.forEach(header => {
                tableHtml += `<th>${cleanData(header)}</th>`;
            });
            tableHtml += "</tr></thead><tbody>";

            rows.slice(1, 6).forEach(row => {
                if (row.trim() === "") return; // Ignorar filas vacías
                const columns = row.split(delimiter);

                tableHtml += "<tr>";
                columns.forEach(column => {
                    tableHtml += `<td>${cleanData(column)}</td>`;
                });
                tableHtml += "</tr>";
            });

            tableHtml += "</tbody></table>";
            previewDiv.innerHTML = tableHtml;
        }

        function cleanData(value) {
            // Elimina comillas dobles, comillas simples, y espacios innecesarios
            return value.replace(/^["']|["']$/g, "").trim();
        }
    });
</script>
