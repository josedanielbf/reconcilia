<script>
    document.getElementById("soaFile").addEventListener("change", handleFile);
    document.getElementById("netsuiteFile").addEventListener("change", handleFile);

    function handleFile(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                const text = e.target.result;
                const delimiter = detectDelimiter(text); // Detectar delimitador
                displayPreview(text, event.target.id, delimiter);
            };
            reader.readAsText(file);
        }
    }

    function detectDelimiter(content) {
        // Detectar si el delimitador es una coma, tabulaciÃ³n u otro
        const delimiters = [',', '\t', ';'];
        const lines = content.split('\n');
        const counts = delimiters.map(delimiter => lines[0].split(delimiter).length);
        const maxIndex = counts.indexOf(Math.max(...counts));
        return delimiters[maxIndex];
    }

    function displayPreview(content, fileType, delimiter) {
        const previewDiv = document.getElementById("preview");
        const rows = content.split("\n").slice(0, 5); // Previsualizar primeras 5 filas
        let tableHtml = `<h3>Preview (${fileType})</h3><table><thead><tr>`;

        // Dividir las columnas de la primera fila para crear los encabezados
        const headers = rows[0].split(delimiter).map(cleanText);
        headers.forEach(header => {
            tableHtml += `<th>${header}</th>`;
        });

        tableHtml += `</tr></thead><tbody>`;
        rows.slice(1).forEach(row => {
            const columns = row.split(delimiter).map(cleanText);
            tableHtml += `<tr>`;
            columns.forEach(column => {
                tableHtml += `<td>${column}</td>`;
            });
            tableHtml += `</tr>`;
        });

        tableHtml += `</tbody></table>`;
        previewDiv.innerHTML = tableHtml;
    }

    function cleanText(text) {
        // Remover comillas y espacios en exceso
        return text.replace(/^"|"$/g, "").trim();
    }
</script>
