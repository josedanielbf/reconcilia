<script>
    document.addEventListener("DOMContentLoaded", function() {
        const fileInput = document.getElementById("soaFile");

        if (fileInput) {
            fileInput.addEventListener("change", handleFile);
        } else {
            console.error("No se encontró el elemento con id 'soaFile'");
        }

        function handleFile(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const text = e.target.result;
                    const delimiter = detectDelimiter(text);
                    const rows = text.split("\n"); // Dividir en filas
                    displayPreview(rows, delimiter);
                };
                reader.readAsText(file);
            } else {
                console.warn("No se seleccionó ningún archivo.");
            }
        }

        function detectDelimiter(content) {
            const delimiters = [',', '\t', ';'];
            const counts = delimiters.map(delimiter => content.split(delimiter).length);
            const maxIndex = counts.indexOf(Math.max(...counts));
            return delimiters[maxIndex];
        }

        function displayPreview(rows, delimiter) {
            const previewDiv = document.getElementById("preview");
            if (rows.length < 2) {
                previewDiv.innerHTML = "<p>El archivo no contiene suficientes datos.</p>";
                return;
            }

            let tableHtml = "<table border='1'><thead><tr>";
            const headers = rows[0].split(delimiter); // Obtener encabezados
            headers.forEach(header => {
                tableHtml += `<th>${header.trim()}</th>`;
            });
            tableHtml += "</tr></thead><tbody>";

            rows.slice(1, 6).forEach(row => { // Mostrar hasta 5 filas
                const columns = row.split(delimiter);
                tableHtml += "<tr>";
                columns.forEach(column => {
                    tableHtml += `<td>${column.trim()}</td>`;
                });
                tableHtml += "</tr>";
            });

            tableHtml += "</tbody></table>";
            previewDiv.innerHTML = tableHtml;
        }
    });
</script>
